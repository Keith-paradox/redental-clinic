<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Redental - Your Trusted Dental Care Partner</title>
    <meta
      name="description"
      content="Redental provides comprehensive dental care services including general dentistry, cosmetic procedures, orthodontics, and emergency care."
    />
    <meta name="author" content="Redental" />

    <meta
      property="og:title"
      content="Redental - Your Trusted Dental Care Partner"
    />
    <meta
      property="og:description"
      content="Comprehensive dental care services in a modern, comfortable environment."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://lovable.dev/opengraph-image-p98pqg.png"
    />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta
      name="twitter:image"
      content="https://lovable.dev/opengraph-image-p98pqg.png"
    />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Widget</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/geist-font/1.0.0/fonts/geist-sans/style.min.css"
    />
    <style>
      /* Chat Widget Styling */
      #chat-widget-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
        z-index: 1000;
        overflow: hidden;
      }

      #chat-widget-header {
        background: #4f9bff;
        color: white;
        padding: 20px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 18px;
      }

      #chat-widget-body {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }

      /* Increased spacing between messages */
      #chat-widget-body p {
        margin-bottom: 15px;
        /* Adjust spacing between messages */
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        word-wrap: break-word;
      }

      #chat-widget-footer {
        padding: 12px;
        border-top: 1px solid #ddd;
        display: flex;
        gap: 10px;
      }

      #chat-widget-input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 8px;
        outline: none;
      }

      #chat-widget-send {
        background: #4f9bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Make the chat bubble a perfect circle */
      #chat-widget-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #4f9bff;
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      }

      #voice-widget-button {
        position: fixed;
        bottom: 20px;
        right: 80px;
        background: #4f9bff;
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      }

      /* Prevent any flicker or preload */
      #convai-widget-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        height: 120px;
        background: white;
        display: none;
        flex-direction: column;
        z-index: 1000;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>

    <button id="voice-widget-button">ðŸ“ž</button>

    <!-- Chat Widget Button -->
    <button id="chat-widget-button">ðŸ’¬</button>

    <!-- Chat Widget -->
    <div id="chat-widget-container">
      <div id="chat-widget-header">
        <span>Chat</span>
        <button onclick="closeChatWidget()">âœ–</button>
      </div>
      <div id="chat-widget-body"></div>
      <div id="chat-widget-footer">
        <input
          type="text"
          id="chat-widget-input"
          placeholder="Type your message here..."
        />
        <button id="chat-widget-send">Send</button>
      </div>
    </div>

    <div id="convai-widget-container">
      <div>
        <elevenlabs-convai agent-id="KREP28KUbtlJXNglJ3nu"></elevenlabs-convai>
      </div>
      <button
        onclick="closeVoiceWidget()"
        style="
          position: absolute;
          right: 0;
          top: 0;
          color: white;
          background: grey;
          border: none;
          width: 24px;
          height: 24px;
          font-weight: bold;
          border-radius: 100%;
          cursor: pointer;
          z-index: 10000;
        "
      >
        âœ–
      </button>
    </div>

    <!-- Chat Widget Script -->
    <script>
      window.ChatWidgetConfig = {
        webhook: {
          url: "https://n8n.8genticai.de/webhook/81345ff4-927b-4816-a6d2-3691c60826a6/chat",
          route: "general",
        },
        style: {
          primaryColor: "#854fff",
          secondaryColor: "#6b3fd4",
          position: "right",
          backgroundColor: "#ffffff",
          fontColor: "#333333",
        },
      };

      // Function to generate or retrieve a unique chat ID
      function getChatId() {
        let chatId = sessionStorage.getItem("chatId");
        if (!chatId) {
          chatId = "chat_" + Math.random().toString(36).substr(2, 9); // Unique ID
          sessionStorage.setItem("chatId", chatId);
        }
        return chatId;
      }

      // Show chat widget and hide bubble
      document
        .getElementById("chat-widget-button")
        .addEventListener("click", function () {
          document.getElementById("chat-widget-container").style.display =
            "flex";
          document.getElementById("chat-widget-button").style.display = "none";
          document.getElementById("voice-widget-button").style.display = "none";
        });

      // Close chat widget and show bubble
      function closeChatWidget() {
        console.log("Closing Convai widget");
        document.getElementById("chat-widget-container").style.display = "none";
        document.getElementById("voice-widget-button").style.display = "flex";
        document.getElementById("chat-widget-button").style.display = "flex";
      }

      // Close chat widget and show bubble
      function closeVoiceWidget() {
        console.log("Closing Convai widget");
        document.getElementById("convai-widget-container").style.display =
          "none";
        document.getElementById("voice-widget-button").style.display = "flex";
        document.getElementById("chat-widget-button").style.display = "flex";
      }

      // Show chat widget and hide bubble
      document
        .getElementById("voice-widget-button")
        .addEventListener("click", function () {
          document.getElementById("convai-widget-container").style.display =
            "flex";
          document.getElementById("chat-widget-button").style.display = "none";
          document.getElementById("voice-widget-button").style.display = "none";
        });
      // Send message to n8n webhook
      document
        .getElementById("chat-widget-send")
        .addEventListener("click", function () {
          let message = document.getElementById("chat-widget-input").value;
          if (message.trim() === "") return;

          let chatBody = document.getElementById("chat-widget-body");
          let newMessage = document.createElement("p");
          newMessage.textContent = message;
          newMessage.style.color = "#333";
          newMessage.style.background = "#f1f1f1";
          chatBody.appendChild(newMessage);

          let chatId = getChatId(); // Retrieve the session chat ID

          fetch(window.ChatWidgetConfig.webhook.url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              chatId: chatId, // Attach chat ID for memory tracking
              message: message,
              route: window.ChatWidgetConfig.webhook.route,
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              let botMessage = document.createElement("p");
              botMessage.innerHTML =
                data.output || "Sorry, I couldn't understand that.";
              botMessage.style.color = "#fff";
              botMessage.style.background = "#854fff";
              botMessage.style.marginTop = "10px";
              chatBody.appendChild(botMessage);
            })
            .catch((error) => console.error("Error:", error));

          document.getElementById("chat-widget-input").value = "";
        });
    </script>

    <script
      src="https://elevenlabs.io/convai-widget/index.js"
      async
      type="text/javascript"
    ></script>

    <script>
      function showConvai() {
        const checkExist = setInterval(() => {
          const widget = document.querySelector("#convai-widget-container");
          if (widget) {
            widget.style.display = "flex";
            clearInterval(checkExist);
          }
        }, 300);
      }
    </script>
  </body>
</html>
